<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
</head>

<body>
    <div class="content">
        <div class="row">
            <!--<div class="col-xs-2">
                How many people are with you:
            </div>
            <div class="col-xs-4 form-group">
                <input type="text" class="form-control"/>
            </div>-->
            <div class="col-xs-2">
                Your budget:
            </div>
            <div class="col-xs-2">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">From</span>
                    <input type="text" class="form-control" />
                </div>
            </div>
            <div class="col-xs-2">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1">To</span>
                    <input type="text" class="form-control" />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-2">
                Interests:
            </div>
            <div class="col-xs-10" data-group="tags">
                <p class="badgeSelect" id="Cities"><span class="fa fa-building-o fa-4x"></span><span>Cities</span></p>
                <p class="badgeSelect" id="Beaches"><span class="fa fa-life-ring fa-4x"></span><span>Beaches</span></p>
                <p class="badgeSelect" id="Nature"><span class="fa fa-tree fa-4x"></span><span>Nature</span></p>
                <p class="badgeSelect" id="Skiing"><span class="fa fa-sort-numeric-desc fa-4x"></span><span>Skiing</span></p>
                <p class="badgeSelect" id="Shopping"><span class="fa fa-shopping-cart fa-4x"></span><span>Shopping</span></p>
                <p class="badgeSelect" id="Nightlife"><span class="fa fa-music fa-4x"></span><span>Nightlife</span></p>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-2">
                Preffered locations:
            </div>
            <div class="col-xs-10" data-group="localization">
                <p class="badgeSelect" id="Spain"><span class="flag"><img src="images/Flags/Spain.png" /></span><span>Spain</span></p>
                <p class="badgeSelect" id="Portugal"><span class="flag"><img src="images/Flags/Portugal.png" /></span><span>Portugal</span></p>
                <p class="badgeSelect" id="France"><span class="flag"><img src="images/Flags/France.png" /></span><span>France</span></p>
                <p class="badgeSelect" id="Germany"><span class="flag"><img src="images/Flags/Germany.png" /></span><span>Germany</span></p>
                <p class="badgeSelect" id="Poland"><span class="flag"><img src="images/Flags/Poland.png" /></span><span>Poland</span></p>
                <p class="badgeSelect" id="UnitedKingdom"><span class="flag"><img src="images/Flags/United_Kingdom.png" /></span><span>UK</span></p>
                <p class="badgeSelect" id="Italy"><span class="flag"><img src="images/Flags/Italy.png" /></span><span>Italy</span></p>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-2">
                Must haves:
            </div>
            <div class="col-xs-10" data-group="musthaves">
                <p class="badgeSelect" id="WheelchairAccessible"><span class="fa fa-wheelchair fa-4x"></span><span>Disability</span></p>
                <p class="badgeSelect" id="ChildFriendly"><span class="fa fa-child fa-4x"></span><span>Child Friendly</span></p>
                <p class="badgeSelect" id="Vegetarian"><span class="fa fa-paragraph fa-4x"></span><span>Parking</span></p>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
        <script>
            $(function () {
                var chosenElements = {
                    tags: [],
                    localization: [],
                    musthaves: []
                };

                var groupId = localStorage.getItem("groupId");
                var userId = localStorage.getItem("userId");

                // TODO
                // assume they're there
                groupId = 1;
                userId = 1;

                var highlightAssignedInDatabase = function (userId, groupId) {
                    $.get('http://localhost/takeoff2016/api/group/' + groupId + '/',
                        // url: 'http://takeoff2016-krkteam.azurewebsites.net/api/group/changePreferences/' + userId + '/' + groupId + '/',
                        function (data) {
                            console.log(data);

                            var userPreferences = data.UserPreferences[userId];
                            var localizations = userPreferences.Localizations;
                            var tags = userPreferences.Tags;
                            var mustHaves = userPreferences.MustHaves;

                            console.log(localizations);
                            console.log(tags);
                            console.log(mustHaves);

                            for (var i = 0; i < localizations.length; i++) {
                                $('p#' + localizations[i]).addClass('active');
                                // console.log('p#' + localizations[i]);
                            }

                            for (var i = 0; i < tags.length; i++) {
                                $('p#' + tags[i]).addClass('active');
                            }

                            for (var i = 0; i < mustHaves.length; i++) {
                                $('p#' + mustHaves[i]).addClass('active');
                                console.log('p#' + mustHaves[i]);
                            }
                        }
                    );
                }

                highlightAssignedInDatabase(userId, groupId);

                $('.badgeSelect').click(function () {
                    // highlight badge
                    if ($(this).hasClass('active')) {
                        $(this).removeClass('active');
                    } else {
                        $(this).addClass('active');
                    }
                    // /highglight badge

                    // save selection
                    var selectedName = $(this).attr('id');

                    var postSelection = function (userId, groupId, selectedName) {
                        $.ajax({
                            url: 'http://localhost/takeoff2016/api/group/changePreferences/' + userId + '/' + groupId + '/' + selectedName + '/',
                            // url: 'http://takeoff2016-krkteam.azurewebsites.net/api/group/changePreferences/' + userId + '/' + groupId + '/',
                            success: function (data) {
                                console.log(data);
                                console.log('success');
                            },
                            error: function (data) {
                                console.log(data);
                                console.log('error');
                            }
                        });
                    }

                    postSelection(userId, groupId, selectedName);
                    // /save selection
                });
            });

        </script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
        <script src="scripts/app.js"></script>
        <div>Next page</div>
    </div>
</body>
</html>